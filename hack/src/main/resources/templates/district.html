<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="utf-8" />
    <title>좌표로 주소를 얻어내기</title>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <link rel="stylesheet" href="/css/sangpop.css?after" />
    <link rel="stylesheet" href="/css/keypop.css" />
    <link rel="stylesheet" href="/css/repop.css" />
    <link rel="stylesheet" href="/css/inpop.css" />
    <link rel="stylesheet" href="/css/analpop.css" />
    <style>
      .map_wrap {
        margin-top: 3px;
        width: 102%;
        height: 100vh;
      }
      #centerAddr {
        display: block;
        margin-top: 2px;
        font-weight: normal;
      }
      .bAddr {
        padding: 5px;
        text-overflow: ellipsis;
        overflow: hidden;
        white-space: nowrap;
      }
    </style>
    <link rel="stylesheet" href="/css/mappop.css" />
  </head>
  <body>
    <div th:replace="~{header.html}"></div>

    <div class="map_wrap">
      <div
        id="map"
        style="width: 100%; height: 100%; position: relative; overflow: hidden"
      >
        <!-- <div th:replace="~{keypop.html}"></div> -->
        <!-- <div th:replace="~{sangpop.html}"></div> -->
        <div class="category-buttons">
          <!-- 상권 1개 -->
          <button id="opensang" class="category-btn" data-category="district">
            상권메뉴비교
          </button>
          <button id="opensang2" class="category-btn" data-category="district">
            상권메뉴비교2
          </button>
          <button id="openkey" class="category-btn" data-category="keyword">
            키워드
          </button>
          <button id="openmenu" class="category-btn" data-category="pub">
            유사메뉴
          </button>

          <!-- <button class="category-btn" data-category="mart">버튼 4</button> -->
        </div>
      </div>

      <div id="re-popup" class="rpopup">
        <div class="rpop-header">
          <h2>추천 고려메뉴</h2>
          <button class="close-btn" id="closereModalBtn">닫기</button>
        </div>

        <ul class="top5-list" id="top5MenuList">
          <li>
            <span class="rank">1</span>
            <span class="category">아메리카노</span>
          </li>
          <li>
            <span class="rank">2</span>
            <span class="category">바닐라라떼</span>
          </li>
          <li>
            <span class="rank">3</span>
            <span class="category">카페라떼</span>
          </li>
          <li>
            <span class="rank">4</span>
            <span class="category">그저 커피</span>
          </li>
          <li>
            <span class="rank">5</span>
            <span class="category">호날두</span>
          </li>
        </ul>
      </div>

      <div id="map-popup" class="spopup" style="display: none">
        <div class="popup-header">
          <h3>위치 선택</h3>
          <button class="close-btn" id="closeMapModalBtn">닫기</button>
        </div>
        <div class="popup-body">
          <!-- 위치 검색 -->
          <div class="location-search">
            <label for="search-location">위치 검색</label>
            <br />
            <input type="text" id="dsearch-location2" placeholder="주소 검색" />
            <div id="search-results"></div>
            <button id="search-btn" class="search-btn">검색</button>
          </div>
          <br />
          <!-- 체크박스 -->
          <div class="checkbox-group">
            <label><input type="checkbox" /> 상권별</label>
            <label><input type="checkbox" /> 공통고려메뉴</label>
          </div>
          <br />
          <!-- 분석하기 버튼 -->
          <button id="analyze-button" class="analyze-btn">분석하기</button>
        </div>
      </div>

      <div id="k-popup" class="ipopup" style="display: none">
        <div class="popup-header">
          <h3>키워드 입력</h3>
          <button class="close-btn" id="closekeyModalBtn">닫기</button>
        </div>
        <label for="keyword"></label>
        <textarea
          type="text"
          id="content"
          name="content"
          placeholder="원하시는 키워드를 입력하세요"
          required
        ></textarea>
        <button type="button" class="submit-btn" onclick="submitForm()">
          제출
        </button>
      </div>
    </div>
    <!-- 메뉴 선택 모달 -->
    <div id="menu-popup" class="popup" style="display: none">
      <div class="popup-header">
        <h3>메뉴 선택</h3>
        <button class="close-btn" id="closeModalBtn">닫기</button>
      </div>
      <div class="location-search">
        <label for="search-location"></label>
        <br />
        <input type="text" id="search-location2" placeholder="주소 검색" />
        <div id="search-results2"></div>
        <button id="search-btn2" class="search-btn">검색</button>
      </div>

      <div class="popup-content">
        <!-- 커피류 -->
        <div class="menu-category coffee">
          <h3>커피류</h3>
          <div class="menu-item">
            <button class="toggle-btn" data-menu="아메리카노">
              아메리카노
            </button>
          </div>
          <div class="menu-item">
            <button class="toggle-btn" data-menu="카페라떼">카페라떼</button>
          </div>
          <div class="menu-item">
            <button class="toggle-btn" data-menu="에스프레소">
              에스프레소
            </button>
          </div>
          <div class="menu-item">
            <button class="toggle-btn" data-menu="플랫화이트">
              플랫화이트
            </button>
          </div>
          <div class="menu-item">
            <button class="toggle-btn" data-menu="바닐라 라떼">
              바닐라 라떼
            </button>
          </div>
          <div class="menu-item">
            <button class="toggle-btn" data-menu="카페모카">카페모카</button>
          </div>
          <div class="menu-item">
            <button class="toggle-btn" data-menu="콜드브루">콜드브루</button>
          </div>
        </div>

        <!-- 차류 -->
        <div class="menu-category tea">
          <h3>차류</h3>
          <div class="menu-item">
            <button class="toggle-btn" data-menu="녹차">녹차</button>
          </div>
          <div class="menu-item">
            <button class="toggle-btn" data-menu="말차 라떼">말차 라떼</button>
          </div>
          <div class="menu-item">
            <button class="toggle-btn" data-menu="얼그레이">얼그레이</button>
          </div>
          <div class="menu-item">
            <button class="toggle-btn" data-menu="버블티">버블티</button>
          </div>
          <div class="menu-item">
            <button class="toggle-btn" data-menu="캐모마일">캐모마일</button>
          </div>
        </div>

        <!-- 주스/스무디류 -->
        <div class="menu-category juice">
          <h3>주스/스무디류</h3>
          <div class="menu-item">
            <button class="toggle-btn" data-menu="오렌지 주스">
              오렌지 주스
            </button>
          </div>
          <div class="menu-item">
            <button class="toggle-btn" data-menu="망고 스무디">
              망고 스무디
            </button>
          </div>
          <div class="menu-item">
            <button class="toggle-btn" data-menu="딸기 스무디">
              딸기 스무디
            </button>
          </div>
          <div class="menu-item">
            <button class="toggle-btn" data-menu="레몬에이드">
              레몬에이드
            </button>
          </div>
        </div>

        <!-- 케이크류 -->
        <div class="menu-category cake">
          <h3>케이크류</h3>
          <div class="menu-item">
            <button class="toggle-btn" data-menu="뉴욕 치즈케이크">
              뉴욕 치즈케이크
            </button>
          </div>
          <div class="menu-item">
            <button class="toggle-btn" data-menu="브라우니">브라우니</button>
          </div>
          <div class="menu-item">
            <button class="toggle-btn" data-menu="딸기무스 케이크">
              딸기무스 케이크
            </button>
          </div>
          <div class="menu-item">
            <button class="toggle-btn" data-menu="레몬 타르트">
              레몬 타르트
            </button>
          </div>
        </div>

        <!-- 빵류 -->
        <div class="menu-category bread">
          <h3>빵류</h3>
          <div class="menu-item">
            <button class="toggle-btn" data-menu="크루아상">크루아상</button>
          </div>
          <div class="menu-item">
            <button class="toggle-btn" data-menu="초코 크루아상">
              초코 크루아상
            </button>
          </div>
          <div class="menu-item">
            <button class="toggle-btn" data-menu="바게트">바게트</button>
          </div>
          <div class="menu-item">
            <button class="toggle-btn" data-menu="플레인 베이글">
              플레인 베이글
            </button>
          </div>
        </div>

        <!-- 과자류 -->
        <div class="menu-category snack">
          <h3>과자류</h3>
          <div class="menu-item">
            <button class="toggle-btn" data-menu="초코칩 쿠키">
              초코칩 쿠키
            </button>
          </div>
          <div class="menu-item">
            <button class="toggle-btn" data-menu="마카롱">마카롱</button>
          </div>
          <div class="menu-item">
            <button class="toggle-btn" data-menu="애플파이">애플파이</button>
          </div>
        </div>

        <!-- 간단식사 -->
        <div class="menu-category meal">
          <h3>간단식사</h3>
          <div class="menu-item">
            <button class="toggle-btn" data-menu="햄 샌드위치">
              햄 샌드위치
            </button>
          </div>
          <div class="menu-item">
            <button class="toggle-btn" data-menu="치킨 샌드위치">
              치킨 샌드위치
            </button>
          </div>
          <div class="menu-item">
            <button class="toggle-btn" data-menu="닭가슴살 샐러드">
              닭가슴살 샐러드
            </button>
          </div>
          <div class="menu-item">
            <button class="toggle-btn" data-menu="크림 파스타">
              크림 파스타
            </button>
          </div>
        </div>

        <!-- 기타 메뉴 -->
        <div class="menu-category others">
          <h3>메뉴 검색</h3>
          <div id="otherMenuList"></div>
          <div id="input-container">
            <input
              type="text"
              id="newMenuInput"
              placeholder="검색하고싶은 메뉴를 추가하고 클릭해주세요"
            />
            <button id="addMenuBtn" class="menu-btn">추가</button>
          </div>
          <!-- 입력된 메뉴들이 추가될 곳 -->
        </div>
        <div class="analyze-section">
          <button id="Canalyzebutton" class="analyze-btn">분석하기</button>
        </div>
      </div>
    </div>

    <div id="analysis-result-popup" class="apopup">
      <div class="apopup-header">
        <h3>분석 결과</h3>
        <button class="close-btn" id="closeResultModalBtn">×</button>
      </div>
      <div class="apopup-content">
        <div class="analysis-section">
          <h4>커피류</h4>
          <ul id="coffee-results" class="analysis-result"></ul>
        </div>
        <div class="analysis-section">
          <h4>차류</h4>
          <ul id="tea-results" class="analysis-result"></ul>
        </div>
      </div>
    </div>

    <script></script>
    <!-- JavaScript -->

    <script>
      // 지도 검색 이벤트
      document
        .getElementById("search-location")
        .addEventListener("input", function () {
          var keyword = this.value;

          if (keyword.length > 0) {
            // 주소 검색을 위한 카카오 API 호출
            geocoder.addressSearch(keyword, function (result, status) {
              if (status === kakao.maps.services.Status.OK) {
                // 검색 결과가 있으면 결과 목록 표시
                var searchResults = document.getElementById("search-results");
                searchResults.innerHTML = ""; // 이전 결과 지우기

                result.forEach(function (item) {
                  var listItem = document.createElement("div");
                  listItem.textContent = item.address_name;
                  listItem.style.padding = "5px";
                  listItem.style.cursor = "pointer";
                  listItem.onclick = function () {
                    // 목록 클릭 시 해당 위치로 이동하고 마커 추가
                    var coords = new kakao.maps.LatLng(item.y, item.x);
                    // map.setCenter(coords);
                    map.panTo(coords);
                    map.setLevel(3);
                    // 기존 마커 제거
                    if (currentMarker) {
                      currentMarker.setMap(null);
                    }

                    // 새로운 마커 생성
                    currentMarker = new kakao.maps.Marker({
                      position: coords,
                      map: map,
                    });

                    // 클릭한 위치의 위도, 경도 표시
                    var message = "위도: " + item.y + ", 경도: " + item.x;
                    document.getElementById("clickLatlng").innerHTML = message;

                    // 다각형 생성
                    createCircle(coords);

                    // 결과 목록 숨기기
                    searchResults.innerHTML = "";
                  };
                  searchResults.appendChild(listItem);
                });
              }
            });
          } else {
            // 입력값이 없으면 목록 지우기
            document.getElementById("search-results").innerHTML = "";
          }
        });
      document
        .getElementById("search-location2")
        .addEventListener("input", function () {
          var keyword = this.value;

          if (keyword.length > 0) {
            // 주소 검색을 위한 카카오 API 호출
            geocoder.addressSearch(keyword, function (result, status) {
              if (status === kakao.maps.services.Status.OK) {
                // 검색 결과가 있으면 결과 목록 표시
                var searchResults = document.getElementById("search-results2");
                searchResults.innerHTML = ""; // 이전 결과 지우기

                result.forEach(function (item) {
                  var listItem = document.createElement("div");
                  listItem.textContent = item.address_name;
                  listItem.style.padding = "5px";
                  listItem.style.cursor = "pointer";
                  listItem.onclick = function () {
                    // 목록 클릭 시 해당 위치로 이동하고 마커 추가
                    var coords = new kakao.maps.LatLng(item.y, item.x);
                    map.setCenter(coords);
                    map.setLevel(3);

                    // 기존 마커 제거
                    if (currentMarker) {
                      currentMarker.setMap(null);
                    }

                    // 새로운 마커 생성
                    currentMarker = new kakao.maps.Marker({
                      position: coords,
                      map: map,
                    });

                    // 클릭한 위치의 위도, 경도 표시
                    var message = "위도: " + item.y + ", 경도: " + item.x;
                    document.getElementById("clickLatlng").innerHTML = message;

                    // 다각형 생성
                    createCircle(coords);

                    // 결과 목록 숨기기
                    searchResults.innerHTML = "";
                  };
                  searchResults.appendChild(listItem);
                });
              }
            });
          } else {
            // 입력값이 없으면 목록 지우기
            document.getElementById("search-results2").innerHTML = "";
          }
        });
      // 검색 버튼 클릭 이벤트
      document
        .getElementById("search-btn")
        .addEventListener("click", function () {
          var address = document.getElementById("search-location").value;

          // 주소로 좌표 검색
          geocoder.addressSearch(address, function (result, status) {
            if (status === kakao.maps.services.Status.OK) {
              var coords = new kakao.maps.LatLng(result[0].y, result[0].x);

              // 지도 중심 이동
              map.setCenter(coords);

              // 이전 검색 마커가 있으면 제거
              if (currentMarker) {
                currentMarker.setMap(null);
              }

              // 검색된 위치에 새 마커 추가
              currentMarker = new kakao.maps.Marker({
                position: coords,
                map: map,
              });

              // 다각형 생성
              createCircle(coords);
            } else {
              alert("해당 주소를 찾을 수 없습니다.");
            }
          });
        });
      // 메뉴 추가 버튼
      document
        .getElementById("addMenuBtn")
        .addEventListener("click", function () {
          var menuName = document.getElementById("newMenuInput").value;
          if (menuName.trim() !== "") {
            var newMenuItem = document.createElement("div");
            newMenuItem.textContent = menuName;
            document.getElementById("otherMenuList").appendChild(newMenuItem);
            document.getElementById("newMenuInput").value = "";
          }
        });
      // 선택된 메뉴 저

      // 메뉴 선택 토글
      document.querySelectorAll(".toggle-btn").forEach((button) => {
        button.addEventListener("click", () => {
          const menu = button.getAttribute("data-menu");
          if (selectedMenus.includes(menu)) {
            selectedMenus.splice(selectedMenus.indexOf(menu), 1);
            button.classList.remove("selected");
          } else {
            selectedMenus.push(menu);
            button.classList.add("selected");
          }
        });
      });

      // 팝업 닫기
      document
        .getElementById("closeMenuPopup")
        .addEventListener("click", () => {
          document.getElementById("menu-popup").style.display = "none";
        });

      document
        .getElementById("closeAnalysisPopup")
        .addEventListener("click", () => {
          document.getElementById("analysis-popup").style.display = "none";
        });
      // 닫기 버튼 이벤트
      document
        .getElementById("closeAnalysisBtn")
        .addEventListener("click", () => {
          document.getElementById("analysis-popup").style.display = "none";
        });
      document.getElementById("closeModalBtn").addEventListener("click", () => {
        document.getElementById("menu-popup").style.display = "none";
      });
    </script>
    <script src="/js/keypop.js"></script>
    <!-- 메뉴 선택 JS -->
    <div id="clickLatlng"></div>

    <script
      type="text/javascript"
      src="//dapi.kakao.com/v2/maps/sdk.js?appkey=5ee6076af595f4d8884d46e046f17e2e&libraries=services"
    ></script>
    <script src="https://use.fontawesome.com/releases/v5.2.0/js/all.js"></script>
    <script src="/js/k_map.js"></script>
  </body>
</html>
